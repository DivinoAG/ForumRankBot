## Relevant Files

- `src/commands/forum-rank.js` - Defines the `/forum-rank` slash command and its execution logic.
- `src/commands/forum-rank.test.js` - Unit tests for the `/forum-rank` command logic.
- `src/index.js` - Main bot entry point, handles Discord client initialization and event listeners.
- `src/utils/discord-api.js` - Utility functions for interacting with the Discord API (e.g., fetching threads, messages, reactions).
- `src/utils/report-generator.js` - Handles the logic for formatting the report output.
- `src/utils/message-formatter.js` - Utility for handling Discord message size limits and formatting (standard vs. embed).
- `README.md` - Project documentation, setup, and deployment instructions.
- `.env` - Configuration for bot token, guild ID, and other environment variables.
- `package.json` - Project dependencies and scripts.
- `/firebase.json` - Firebase project configuration.
- `/functions/index.js` - Entry point for Firebase Functions.

### Notes

- Unit tests should typically be placed alongside the code files they are testing (e.g., `MyComponent.tsx` and `MyComponent.test.tsx` in the same directory).
- Use `npx jest [optional/path/to/test/file]` to run tests. Running without a path executes all tests found by the Jest configuration.

## Tasks

- [x] 1.0 Project Setup and Dependencies
  - [x] 1.1 Initialize a new Node.js project with `npm init -y`.
  - [x] 1.2 Install necessary Discord.js library and other dependencies (`npm install discord.js dotenv`).
  - [x] 1.3 Set up `.env` file for Discord bot token and client ID.
  - [x] 1.4 Configure `package.json` for development scripts (e.g., `start`, `dev`).
  - [x] 1.5 Set up a basic project structure (e.g., `src/`, `src/commands/`, `src/utils/`).
- [x] 2.0 Discord Bot Command Handling
  - [x] 2.1 Implement Discord client initialization and login.
  - [x] 2.2 Register the `/forum-rank` slash command with Discord API, including `channel`, `number_of_posts`, and `direct_message` parameters.
  - [x] 2.3 Implement command interaction listener to handle `/forum-rank` command execution.
  - [x] 2.4 Implement logic to restrict command usage to server moderators.
- [x] 3.0 Forum Thread Data Retrieval and Processing
  - [x] 3.1 Develop a utility function to fetch all threads from a given forum channel ID.
  - [x] 3.2 For each thread, fetch its initial message to access reactions.
  - [x] 3.3 Identify and count only the primary reaction (default emoji) on the initial message.
  - [x] 3.4 Extract thread name and associated tags.
  - [x] 3.5 Sort threads by primary reaction count in descending order.
  - [x] 3.6 Implement logic to limit the number of results based on the `number_of_posts` parameter.
- [x] 4.0 Report Generation and Output
  - [x] 4.1 Develop a function to format the processed thread data into a readable report string.
  - [x] 4.2 Implement logic to check report string length against Discord message limits.
  - [x] 4.3 If the report exceeds limits, format it as an embedded message.
  - [x] 4.4 Implement logic to send the report to the originating channel or as a DM based on the `direct_message` parameter.
- [x] 5.0 Deployment and Configuration
  - [x] 5.1 Prepare the project for deployment on a Node.js hosting provider (e.g., Railway, Render, Heroku).
  - [x] 5.2 Document deployment steps for the chosen hosting provider.
  - [x] 5.3 Add error handling and logging for production environment.
  - [x] 5.4 Implement basic unit tests for core functionalities (e.g., reaction counting, report formatting, command parsing).
- [x] 6.0 Documentation
  - [x] 6.1 Create `README.md` file.
  - [x] 6.2 Add detailed instructions for project setup (dependencies, environment variables).
  - [x] 6.3 Include steps for creating a Discord bot application and obtaining necessary tokens/IDs.
  - [x] 6.4 Provide comprehensive deployment instructions for Vercel.
  - [x] 6.5 Maintain and update `README.md` as the project evolves.
- [ ] 7.0 Firebase Project Setup and Initialization
  - [ ] 7.1 Create a new Firebase project in the Firebase console.
  - [ ] 7.2 Install the Firebase CLI globally (`npm install -g firebase-tools`).
  - [ ] 7.3 Log in to Firebase using the CLI (`firebase login`).
  - [ ] 7.4 Initialize Firebase in the project directory (`firebase init`).
  - [ ] 7.5 Select 'Functions' and associate the project with the new Firebase project.
  - [ ] 7.6 Choose JavaScript as the language for Cloud Functions.
  - [ ] 7.7 Install dependencies for Firebase Functions.
- [ ] 8.0 Adapt Bot for Firebase Functions
  - [ ] 8.1 Refactor the bot's core logic (`src/index.js`, `src/commands/forum-rank.js`) to be callable from a Firebase Function HTTP trigger.
  - [ ] 8.2 Modify the command handling to process incoming Discord Interaction HTTP requests instead of WebSocket events.
  - [ ] 8.3 Ensure the logic remains stateless as required by serverless functions.
- [ ] 9.0 Implement Discord Interaction Endpoint
  - [ ] 9.1 Create an HTTP triggered Firebase Function (e.g., `functions/index.js`) to act as the Discord Interaction Endpoint.
  - [ ] 9.2 Implement logic within the function to verify incoming Discord requests using the signature and timestamp headers.
  - [ ] 9.3 Parse the incoming interaction payload to extract command details and parameters.
  - [ ] 9.4 Call the refactored bot logic with the parsed command details.
  - [ ] 9.5 Format and send the response back to Discord via an HTTP response from the function.
- [ ] 10.0 Secure Configuration with Firebase
  - [ ] 10.1 Migrate sensitive keys (Discord Bot Token, Discord Public Key, Guild ID, etc.) from `.env` to Firebase Functions environment configuration using `firebase functions:config:set`.
  - [ ] 10.2 Update the code to access these values via `process.env` or `functions.config()`.
- [ ] 11.0 Deployment to Firebase
  - [ ] 11.1 Deploy the Firebase Function using `firebase deploy --only functions`.
  - [ ] 11.2 Obtain the public URL for the deployed HTTP function.
  - [ ] 11.3 Configure the Discord Application's Interaction Endpoint URL to point to the deployed Firebase Function URL.
- [ ] 12.0 Testing and Verification on Firebase
  - [ ] 12.1 Test the `/forum-rank` command in Discord to ensure it triggers the Firebase Function.
  - [ ] 12.2 Verify that the function executes correctly and retrieves forum data.
  - [ ] 12.3 Confirm that the report is generated and sent back to Discord correctly.
  - [ ] 12.4 Test the `number_of_posts` and `direct_message` parameters.
  - [ ] 12.5 Monitor Firebase Function logs for errors or performance issues.